<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>HSK3 Quiz - Luy·ªán t·ª´ v·ª±ng</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    text-align: center;
    background: #f5f7fa;
    margin: 0; padding: 0;
  }
  h1 { background: #0078d7; color: white; padding: 15px; margin: 0; }
  #upload { margin: 20px; }
  .quiz-box {
    background: white;
    max-width: 500px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 20px;
  }
  .word { font-size: 40px; margin: 20px 0; color: #333; }
  button.option {
    display: block;
    width: 90%;
    margin: 10px auto;
    padding: 10px;
    border: 2px solid #0078d7;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    font-size: 18px;
    transition: 0.2s;
  }
  button.option:hover { background: #e6f0ff; }
  .correct { background: #c8f7c5 !important; }
  .wrong { background: #f8d7da !important; }
  #score { font-weight: bold; margin-top: 10px; }
  #pinyin { font-size: 20px; color: gray; margin-bottom: 10px; }
  .audio-btn {
    background: none; border: none; font-size: 28px; cursor: pointer;
  }
</style>
</head>
<body>
<h1>Luy·ªán t·ª´ v·ª±ng HSK3</h1>

<input type="file" id="upload" accept=".xlsx,.xls">
<div class="quiz-box" id="quizBox" style="display:none;">
  <div class="word" id="word"></div>
  <div id="pinyin"></div>
  <button class="audio-btn" id="speakBtn">üîä</button>
  <div id="options"></div>
  <div id="feedback"></div>
  <div id="score"></div>
</div>

<script>
let vocab = [];
let currentWord = null;
let score = 0, total = 0;

document.getElementById("upload").addEventListener("change", handleFile, false);

function handleFile(e) {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(evt) {
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, {type: "array"});
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(firstSheet, {header:1});
    vocab = rows.slice(1).map(r => ({
      hanzi: r[0],
      pinyin: r[1],
      meaning: r[2]
    })).filter(r => r.hanzi && r.meaning);
    document.getElementById("quizBox").style.display = "block";
    nextQuestion();
  };
  reader.readAsArrayBuffer(file);
}

function nextQuestion() {
  const randomIndex = Math.floor(Math.random() * vocab.length);
  currentWord = vocab[randomIndex];
  document.getElementById("word").textContent = currentWord.hanzi;
  document.getElementById("pinyin").textContent = currentWord.pinyin;
  document.getElementById("feedback").textContent = "";

  // T·∫°o danh s√°ch 4 l·ª±a ch·ªçn
  let options = [currentWord.meaning];
  while (options.length < 4) {
    const rand = vocab[Math.floor(Math.random() * vocab.length)].meaning;
    if (!options.includes(rand)) options.push(rand);
  }
  options = options.sort(() => Math.random() - 0.5);
  const container = document.getElementById("options");
  container.innerHTML = "";
  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.className = "option";
    btn.onclick = () => checkAnswer(btn, opt);
    container.appendChild(btn);
  });

  speak(currentWord.hanzi);
}

function checkAnswer(btn, selected) {
  const buttons = document.querySelectorAll(".option");
  buttons.forEach(b => b.disabled = true);
  if (selected === currentWord.meaning) {
    btn.classList.add("correct");
    document.getElementById("feedback").textContent = "‚úÖ Ch√≠nh x√°c!";
    score++;
  } else {
    btn.classList.add("wrong");
    document.getElementById("feedback").textContent = 
      `‚ùå Sai! ƒê√°p √°n ƒë√∫ng: ${currentWord.meaning}`;
  }
  total++;
  document.getElementById("score").textContent = `ƒêi·ªÉm: ${score}/${total}`;
  setTimeout(nextQuestion, 1500);
}

function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "zh-CN";
  speechSynthesis.speak(utter);
}

document.getElementById("speakBtn").onclick = () => {
  speak(currentWord.hanzi);
};
</script>
</body>
</html>
